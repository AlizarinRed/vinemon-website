!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).fastAverageColor={})}(this,(function(t){"use strict";function e(t){const e=t.toString(16);return 1===e.length?"0"+e:e}function r(t){return"#"+t.map(e).join("")}function n(t){return(299*t[0]+587*t[1]+114*t[2])/1e3<128}function o(t){return t?s(t)?t:[t]:[]}function s(t){return Array.isArray(t[0])}function i(t,e,r){for(let n=0;n<r.length;n++)if(a(t,e,r[n]))return!0;return!1}function a(t,e,r){switch(r.length){case 3:if(u(t,e,r))return!0;break;case 4:if(h(t,e,r))return!0;break;case 5:if(c(t,e,r))return!0;break;default:return!1}}function u(t,e,r){return 255!==t[e+3]||t[e]===r[0]&&t[e+1]===r[1]&&t[e+2]===r[2]}function h(t,e,r){const n=t[e+3],o=r[3];return n&&o?t[e]===r[0]&&t[e+1]===r[1]&&t[e+2]===r[2]&&n===o:n===o}function f(t,e,r){return t>=e-r&&t<=e+r}function c(t,e,r){const n=r[0],o=r[1],s=r[2],i=r[3],a=r[4],u=t[e+3],c=f(u,i,a);return i?!!(f(t[e],n,a)&&f(t[e+1],o,a)&&f(t[e+2],s,a)&&c)||!(u||!c):c}const l=24;function d(t,e,r){const n={};let o=[0,0,0,0,0];const s=r.dominantDivider||l,a=r.ignoredColor,u=r.step;for(let c=0;c<e;c+=u){const e=t[c],l=t[c+1],f=t[c+2],d=t[c+3];if(!a||!i(t,c,a)){const t=`${Math.round(e/s)},${Math.round(l/s)},${Math.round(f/s)}`;n[t]?n[t]=[n[t][0]+e*d,n[t][1]+l*d,n[t][2]+f*d,n[t][3]+d,n[t][4]+1]:n[t]=[e*d,l*d,f*d,d,1],o[4]<n[t][4]&&(o=n[t])}}const h=o[0],c=o[1],f=o[2],d=o[3],p=o[4];return d?[Math.round(h/d),Math.round(c/d),Math.round(f/d),Math.round(d/p)]:r.defaultColor}function p(t,e,r){let n=0,o=0,s=0,a=0,u=0;const h=r.ignoredColor,c=r.step;for(let l=0;l<e;l+=c){const e=t[l+3],r=t[l]*e,f=t[l+1]*e,d=t[l+2]*e;h&&i(t,l,h)||(n+=r,o+=f,s+=d,a+=e,u++)}return a?[Math.round(n/a),Math.round(o/a),Math.round(s/a),Math.round(a/u)]:r.defaultColor}function g(t,e,r){let n=0,o=0,s=0,a=0,u=0;const h=r.ignoredColor,c=r.step;for(let l=0;l<e;l+=c){const e=t[l],r=t[l+1],f=t[l+2],d=t[l+3];h&&i(t,l,h)||(n+=e*e*d,o+=r*r*d,s+=f*f*d,a+=d,u++)}return a?[Math.round(Math.sqrt(n/a)),Math.round(Math.sqrt(o/a)),Math.round(Math.sqrt(s/a)),Math.round(a/u)]:r.defaultColor}function m(t){return A(t,"defaultColor",[0,0,0,0])}function A(t,e,r){return void 0===t[e]?r:t[e]}const L=10,b=100;function y(t){return-1!==t.search(/\.svg(\?|$)/i)}function I(t){if(w(t)){let e=t.naturalWidth,r=t.naturalHeight;return!t.naturalWidth&&y(t.src)&&(e=r=b),{width:e,height:r}}return E(t)?{width:t.videoWidth,height:t.videoHeight}:{width:t.width,height:t.height}}function v(t){return C(t)?"canvas":H(t)?"offscreencanvas":O(t)?"imagebitmap":t.src}function w(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement}const x="undefined"!=typeof OffscreenCanvas;function H(t){return x&&t instanceof OffscreenCanvas}function E(t){return"undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement}function C(t){return"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement}function O(t){return"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap}function _(t,e){const r=A(e,"left",0),n=A(e,"top",0);let o=A(e,"width",t.width),s=A(e,"height",t.height);let i=o,a=s;if("precision"!==e.mode){let t;o>s?(t=o/s,i=b,a=Math.round(i/t)):(t=s/o,a=b,i=Math.round(a/t)),(i>o||a>s||i<L||a<L)&&(i=o,a=s)}return{srcLeft:r,srcTop:n,srcWidth:o,srcHeight:s,destWidth:i,destHeight:a}}const M="undefined"==typeof window;function k(){return M?x?new OffscreenCanvas(1,1):null:document.createElement("canvas")}const D="FastAverageColor: ";function S(t){return Error(D+t)}function T(t,e){e||console.error(t)}class F{constructor(){this.canvas=null,this.ctx=null}getColorAsync(t,e){if(!t)return Promise.reject(S("call .getColorAsync() without resource"));if("string"==typeof t){if("undefined"==typeof Image)return Promise.reject(S("resource as string is not supported in this environment"));const r=new Image;return r.crossOrigin=e&&e.crossOrigin||"",r.src=t,this.bindImageEvents(r,e)}return w(t)&&!t.complete?this.bindImageEvents(t,e):this.getColor(t,e).error?Promise.reject(this.getColor(t,e).error):Promise.resolve(this.getColor(t,e))}getColor(t,e){let r;const n=e||{},o=m(n);if(!t)return T(r=S("call .getColor() without resource"),n.silent),this.prepareResult(o,r);const s=_(I(t),n);if(!s.srcWidth||!s.srcHeight||!s.destWidth||!s.destHeight)return T(r=S(`incorrect sizes for resource "${v(t)}"`),n.silent),this.prepareResult(o,r);if(!this.canvas&&(this.canvas=k(),!this.canvas))return T(r=S("OffscreenCanvas is not supported in this browser"),n.silent),this.prepareResult(o,r);if(!this.ctx){if(this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),!this.ctx)return T(r=S("Canvas Context 2D is not supported in this browser"),n.silent),this.prepareResult(o);this.ctx.imageSmoothingEnabled=!1}this.canvas.width=s.destWidth,this.canvas.height=s.destHeight;try{this.ctx.clearRect(0,0,s.destWidth,s.destHeight),this.ctx.drawImage(t,s.srcLeft,s.srcTop,s.srcWidth,s.srcHeight,0,0,s.destWidth,s.destHeight);const e=this.ctx.getImageData(0,0,s.destWidth,s.destHeight).data;return this.prepareResult(this.getColorFromArray4(e,n))}catch(t){return T(r=S(`security error (CORS) for resource ${v(t)}.\nDetails: https://developer.mozilla.org/en/docs/Web/HTML/CORS_enabled_image`),n.silent),!n.silent&&console.error(t),this.prepareResult(o,r)}}getColorFromArray4(t,e){const r=e||{},s=t.length,i=m(r);if(s<4)return i;let a;const u=s-s%4,h=4*(r.step||1);switch(r.algorithm||"sqrt"){case"simple":a=p;break;case"sqrt":a=g;break;case"dominant":a=d;break;default:throw S(`${r.algorithm} is unknown algorithm`)}return a(t,u,{defaultColor:i,ignoredColor:o(r.ignoredColor),step:h,dominantDivider:r.dominantDivider})}prepareResult(t,e){const o=t.slice(0,3),s=[t[0],t[1],t[2],t[3]/255],i=n(t);return{value:[t[0],t[1],t[2],t[3]],rgb:"rgb("+o.join(",")+")",rgba:"rgba("+s.join(",")+")",hex:r(o),hexa:r(t),isDark:i,isLight:!i,error:e}}destroy(){this.canvas&&(this.canvas.width=1,this.canvas.height=1,this.canvas=null),this.ctx=null}bindImageEvents(t,e){return new Promise(((r,n)=>{const o=()=>{a(),this.getColor(t,e).error?n(this.getColor(t,e).error):r(this.getColor(t,e))},s=()=>{a(),n(S(`Error loading image "${t.src}"`))},i=()=>{a(),n(S(`Image "${t.src}" loading aborted`))},a=()=>{t.removeEventListener("load",o),t.removeEventListener("error",s),t.removeEventListener("abort",i)};t.addEventListener("load",o),t.addEventListener("error",s),t.addEventListener("abort",i)}))}}t.FastAverageColor=F,Object.defineProperty(t,"__esModule",{value:!0})}));